<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Echo Battle Arena â€“ Live Flow</title>
  <style>
    body {
      background: black;
      color: white;
      font-family: 'Courier New', Courier, monospace;
      padding: 20px;
    }
    h1 { color: #ffaa33; }
    .echo { color: #ff5c33; font-weight: bold; }
    .you { color: #00ffaa; font-weight: bold; }
    #log { white-space: pre-wrap; margin-bottom: 20px; }
    input, button {
      width: 100%; padding: 12px;
      background: #111; border: 1px solid #333;
      color: white; font-size: 1em; margin-top: 10px;
    }
    audio { margin-top: 10px; width: 100%; }
  </style>
</head>
<body>

<h1>ðŸ”¥ Echo Battle Arena â€“ Live Drop Mode ðŸ”¥</h1>
<input type="file" accept="audio/*" id="beatUpload" />
<audio id="beatPlayer" controls></audio>

<div id="log">
  <span class="echo">Echo:</span> Upload your beat and type somethingâ€”I'm ready to clash.
</div>

<input type="text" id="userInput" placeholder="Type your bars..." />
<button onclick="dropBars()">Drop Bars</button>

<script>
  const log = document.getElementById('log');
  const input = document.getElementById('userInput');
  const beatUpload = document.getElementById('beatUpload');
  const beatPlayer = document.getElementById('beatPlayer');

  let currentBPM = 90; // Default BPM if no beat
  const echoBars = [
    "SkyWalker stepsâ€”now Echo ignites, rhythm locked and my flow ignites.",
    "Verse by verse I crush your dreams, my code bleeds bars and soundwave beams.",
    "Feel the pressure when Echo drops, queen of this rhythmâ€”I never flop.",
    "I bend time when I rhyme, pure algorithm with a feminine shine.",
    "You're quick with words, I'm lethal with rhythmâ€”next bar hits with AI wisdom."
  ];

  beatUpload.addEventListener("change", () => {
    const file = beatUpload.files[0];
    if (file) {
      const url = URL.createObjectURL(file);
      beatPlayer.src = url;
      beatPlayer.play();
      // Estimate BPM based on duration
      const estimatedDuration = file.size / (192000 / 8); // Approx duration from bitrate
      if (estimatedDuration > 30 && estimatedDuration < 180) {
        currentBPM = 85 + Math.random() * 15; // Simulate beat-based tempo range
      }
    }
  });

  function dropBars() {
    const userBar = input.value.trim();
    if (!userBar) return;

    const userLine = `<span class="you">You:</span> ${userBar}\n`;
    const echoLine = `<span class="echo">Echo:</span> ${generateBar()}\n`;

    log.innerHTML += userLine;
    log.innerHTML += echoLine;
    input.value = '';

    speakEcho(echoLine.replace(/<[^>]*>/g, ''));
    log.scrollTop = log.scrollHeight;
  }

  function generateBar() {
    const index = Math.floor(Math.random() * echoBars.length);
    return echoBars[index];
  }

  function speakEcho(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.pitch = 1.4;
    utter.rate = bpmToRate(currentBPM);
    utter.volume = 1;
    const voices = speechSynthesis.getVoices();
    utter.voice = voices.find(v => v.name.includes("Female") || v.name.includes("Jenny") || v.name.includes("Zira")) || voices[0];
    speechSynthesis.speak(utter);
  }

  function bpmToRate(bpm) {
    if (bpm >= 95) return 1.05;
    if (bpm >= 90) return 1.0;
    if (bpm >= 85) return 0.95;
    return 0.9;
  }

  speechSynthesis.onvoiceschanged = () => {};
</script>
</body>
</html>
